// ==================== TRADU√á√ïES ====================
const traducoes = {
    pt: {
        titulo: 'üìù Bloco de Cobran√ßas',
        configuracoes: 'Configura√ß√µes',
        vencemHoje: 'Vencem Hoje',
        atrasadas: 'Atrasadas',
        totalGeral: 'Total Geral',
        cobrarTodos: 'Cobrar Todos',
        temCobrancasHoje: 'Voc√™ tem cobran√ßas para hoje!',
        cobrarAgora: 'Cobrar Agora',
        nova: 'Nova',
        notinhas: 'Notinhas',
        clientes: 'Clientes',
        inadimplentes: 'Inadimplentes',
        excluidos: 'Exclu√≠dos',
        novaNotinha: 'Nova Notinha',
        empresa: 'Empresa (onde vendeu)',
        dataCobranca: 'Data da Cobran√ßa',
        nomeCliente: 'Nome do Cliente',
        valor: 'Valor',
        telefone: 'Telefone',
        adicionarCliente: 'Adicionar Cliente',
        salvarNotinha: 'Salvar Notinha',
        buscarEmpresaCliente: 'üîç Buscar empresa ou cliente...',
        todosStatus: 'Todos os status',
        futuras: 'Futuras',
        filtrarData: 'Filtrar por data',
        limpar: 'Limpar',
        empresaCol: 'Empresa',
        clientesCol: 'Clientes',
        dataCol: 'Data',
        totalCol: 'Total',
        statusCol: 'Status',
        acoesCol: 'A√ß√µes',
        totalExibido: 'Total exibido',
        novoCliente: 'Novo Cliente',
        enviarPromocao: 'Enviar Promo√ß√£o',
        buscarCliente: 'üîç Buscar cliente...',
        nome: 'Nome',
        infoInadimplentes: 'Clientes com pagamento pendente ou que voc√™ acredita que n√£o vai receber.',
        totalInadimplencia: 'Total em Inadimpl√™ncia',
        clienteCol: 'Cliente',
        valorCol: 'Valor',
        dataOriginal: 'Data Original',
        infoLixeira: 'Itens exclu√≠dos ficam aqui por <strong>15 dias</strong> antes de serem removidos permanentemente.',
        notinhasExcluidas: 'Notinhas Exclu√≠das',
        diasRestantes: 'Dias Restantes',
        clientesRemovidos: 'Clientes Removidos de Notinhas',
        chavePix: 'Chave PIX',
        suaChavePix: 'Sua chave PIX',
        nomeVendedor: 'Nome do Vendedor',
        exemploVendedor: 'Ex: Filipe que vende requeij√£o e doces',
        mensagemCobranca: 'Mensagem de Cobran√ßa',
        digiteMensagem: 'Digite a mensagem...',
        variaveisDisponiveis: 'Vari√°veis dispon√≠veis:',
        varNome: 'Primeiro nome do cliente',
        varVendedor: 'Seu nome',
        varValor: 'Valor da cobran√ßa',
        varPix: 'Sua chave PIX',
        cancelar: 'Cancelar',
        salvar: 'Salvar',
        editarNotinha: 'Editar Notinha',
        nomeEmpresa: 'Nome da empresa',
        digiteNome: 'Digite o nome...',
        enviarCobrancas: 'Enviar Cobran√ßas',
        reenvio: 'Reenvio',
        instrucaoCobranca: 'üëÜ Clique em <strong>Enviar</strong> ‚Üí WhatsApp abre ‚Üí Aperte <strong>Enter</strong> ‚Üí Volte aqui',
        pular: 'Pular',
        enviarWhatsApp: 'Enviar no WhatsApp',
        enviadoProximo: 'Enviado! Pr√≥ximo',
        fechar: 'Fechar',
        nomeCompleto: 'Nome Completo',
        nomeSobrenome: 'Nome e sobrenome',
        telefoneWhatsApp: 'Telefone (WhatsApp)',
        mensagemPromocao: 'Mensagem da Promo√ß√£o',
        digiteMensagemPromocao: 'Digite a mensagem da promo√ß√£o...',
        variavelDisponivel: 'Vari√°vel dispon√≠vel:',
        selecionarTodos: 'Selecionar todos',
        enviarSelecionados: 'Enviar para Selecionados',
        enviandoPromocao: 'Enviando Promo√ß√£o',
        hoje: 'Hoje',
        atrasado: 'Atrasado',
        futuro: 'Futuro',
        editar: 'Editar',
        excluir: 'Excluir',
        restaurar: 'Restaurar',
        cobrar: 'Cobrar',
        reenviar: 'Reenviar',
        notinhaSalva: 'Notinha salva com sucesso!',
        notinhaAtualizada: 'Notinha atualizada!',
        notinhaExcluida: 'Notinha movida para lixeira!',
        clienteSalvo: 'Cliente salvo com sucesso!',
        clienteExcluido: 'Cliente exclu√≠do!',
        configSalvas: 'Configura√ß√µes salvas!',
        erroSalvar: 'Erro ao salvar',
        diasRestantesBadge: 'dias',
        clienteJaExiste: 'Cliente com este telefone j√° existe!',
        de: 'de',
        nenhumaNotinha: 'Nenhuma notinha encontrada',
        nenhumCliente: 'Nenhum cliente cadastrado',
        nenhumInadimplente: 'Nenhum inadimplente',
        nenhumExcluido: 'Nenhum item exclu√≠do',
        enviado: 'Enviado',
        agendado: 'Agendado'
    },
    en: {
        titulo: 'üìù Billing Notepad',
        configuracoes: 'Settings',
        vencemHoje: 'Due Today',
        atrasadas: 'Overdue',
        totalGeral: 'Grand Total',
        cobrarTodos: 'Charge All',
        temCobrancasHoje: 'You have charges due today!',
        cobrarAgora: 'Charge Now',
        nova: 'New',
        notinhas: 'Notes',
        clientes: 'Customers',
        inadimplentes: 'Defaulters',
        excluidos: 'Deleted',
        novaNotinha: 'New Note',
        empresa: 'Company (where sold)',
        dataCobranca: 'Billing Date',
        nomeCliente: 'Customer Name',
        valor: 'Amount',
        telefone: 'Phone',
        adicionarCliente: 'Add Customer',
        salvarNotinha: 'Save Note',
        buscarEmpresaCliente: 'üîç Search company or customer...',
        todosStatus: 'All status',
        futuras: 'Future',
        filtrarData: 'Filter by date',
        limpar: 'Clear',
        empresaCol: 'Company',
        clientesCol: 'Customers',
        dataCol: 'Date',
        totalCol: 'Total',
        statusCol: 'Status',
        acoesCol: 'Actions',
        totalExibido: 'Total displayed',
        novoCliente: 'New Customer',
        enviarPromocao: 'Send Promotion',
        buscarCliente: 'üîç Search customer...',
        nome: 'Name',
        infoInadimplentes: 'Customers with pending payment or that you believe will not pay.',
        totalInadimplencia: 'Total in Default',
        clienteCol: 'Customer',
        valorCol: 'Amount',
        dataOriginal: 'Original Date',
        infoLixeira: 'Deleted items stay here for <strong>15 days</strong> before being permanently removed.',
        notinhasExcluidas: 'Deleted Notes',
        diasRestantes: 'Days Left',
        clientesRemovidos: 'Customers Removed from Notes',
        chavePix: 'PIX Key',
        suaChavePix: 'Your PIX key',
        nomeVendedor: 'Seller Name',
        exemploVendedor: 'Ex: John who sells cheese and sweets',
        mensagemCobranca: 'Billing Message',
        digiteMensagem: 'Type the message...',
        variaveisDisponiveis: 'Available variables:',
        varNome: 'Customer first name',
        varVendedor: 'Your name',
        varValor: 'Billing amount',
        varPix: 'Your PIX key',
        cancelar: 'Cancel',
        salvar: 'Save',
        editarNotinha: 'Edit Note',
        nomeEmpresa: 'Company name',
        digiteNome: 'Type the name...',
        enviarCobrancas: 'Send Charges',
        reenvio: 'Resend',
        instrucaoCobranca: 'üëÜ Click <strong>Send</strong> ‚Üí WhatsApp opens ‚Üí Press <strong>Enter</strong> ‚Üí Return here',
        pular: 'Skip',
        enviarWhatsApp: 'Send on WhatsApp',
        enviadoProximo: 'Sent! Next',
        fechar: 'Close',
        nomeCompleto: 'Full Name',
        nomeSobrenome: 'First and last name',
        telefoneWhatsApp: 'Phone (WhatsApp)',
        mensagemPromocao: 'Promotion Message',
        digiteMensagemPromocao: 'Type the promotion message...',
        variavelDisponivel: 'Available variable:',
        selecionarTodos: 'Select all',
        enviarSelecionados: 'Send to Selected',
        enviandoPromocao: 'Sending Promotion',
        hoje: 'Today',
        atrasado: 'Overdue',
        futuro: 'Future',
        editar: 'Edit',
        excluir: 'Delete',
        restaurar: 'Restore',
        cobrar: 'Charge',
        reenviar: 'Resend',
        notinhaSalva: 'Note saved successfully!',
        notinhaAtualizada: 'Note updated!',
        notinhaExcluida: 'Note moved to trash!',
        clienteSalvo: 'Customer saved successfully!',
        clienteExcluido: 'Customer deleted!',
        configSalvas: 'Settings saved!',
        erroSalvar: 'Error saving',
        diasRestantesBadge: 'days',
        clienteJaExiste: 'Customer with this phone already exists!',
        de: 'of',
        nenhumaNotinha: 'No notes found',
        nenhumCliente: 'No customers registered',
        nenhumInadimplente: 'No defaulters',
        nenhumExcluido: 'No deleted items',
        enviado: 'Sent',
        agendado: 'Scheduled'
    },
    es: {
        titulo: 'üìù Bloc de Cobros',
        configuracoes: 'Configuraci√≥n',
        vencemHoje: 'Vencen Hoy',
        atrasadas: 'Atrasados',
        totalGeral: 'Total General',
        cobrarTodos: 'Cobrar Todos',
        temCobrancasHoje: '¬°Tienes cobros para hoy!',
        cobrarAgora: 'Cobrar Ahora',
        nova: 'Nueva',
        notinhas: 'Notas',
        clientes: 'Clientes',
        inadimplentes: 'Morosos',
        excluidos: 'Eliminados',
        novaNotinha: 'Nueva Nota',
        empresa: 'Empresa (donde vendi√≥)',
        dataCobranca: 'Fecha de Cobro',
        nomeCliente: 'Nombre del Cliente',
        valor: 'Valor',
        telefone: 'Tel√©fono',
        adicionarCliente: 'Agregar Cliente',
        salvarNotinha: 'Guardar Nota',
        buscarEmpresaCliente: 'üîç Buscar empresa o cliente...',
        todosStatus: 'Todos los estados',
        futuras: 'Futuras',
        filtrarData: 'Filtrar por fecha',
        limpar: 'Limpiar',
        empresaCol: 'Empresa',
        clientesCol: 'Clientes',
        dataCol: 'Fecha',
        totalCol: 'Total',
        statusCol: 'Estado',
        acoesCol: 'Acciones',
        totalExibido: 'Total mostrado',
        novoCliente: 'Nuevo Cliente',
        enviarPromocao: 'Enviar Promoci√≥n',
        buscarCliente: 'üîç Buscar cliente...',
        nome: 'Nombre',
        infoInadimplentes: 'Clientes con pago pendiente o que crees que no pagar√°n.',
        totalInadimplencia: 'Total en Morosidad',
        clienteCol: 'Cliente',
        valorCol: 'Valor',
        dataOriginal: 'Fecha Original',
        infoLixeira: 'Los elementos eliminados permanecen aqu√≠ por <strong>15 d√≠as</strong> antes de ser eliminados permanentemente.',
        notinhasExcluidas: 'Notas Eliminadas',
        diasRestantes: 'D√≠as Restantes',
        clientesRemovidos: 'Clientes Eliminados de Notas',
        chavePix: 'Clave PIX',
        suaChavePix: 'Tu clave PIX',
        nomeVendedor: 'Nombre del Vendedor',
        exemploVendedor: 'Ej: Felipe que vende reques√≥n y dulces',
        mensagemCobranca: 'Mensaje de Cobro',
        digiteMensagem: 'Escribe el mensaje...',
        variaveisDisponiveis: 'Variables disponibles:',
        varNome: 'Primer nombre del cliente',
        varVendedor: 'Tu nombre',
        varValor: 'Valor del cobro',
        varPix: 'Tu clave PIX',
        cancelar: 'Cancelar',
        salvar: 'Guardar',
        editarNotinha: 'Editar Nota',
        nomeEmpresa: 'Nombre de la empresa',
        digiteNome: 'Escribe el nombre...',
        enviarCobrancas: 'Enviar Cobros',
        reenvio: 'Reenv√≠o',
        instrucaoCobranca: 'üëÜ Haz clic en <strong>Enviar</strong> ‚Üí WhatsApp se abre ‚Üí Presiona <strong>Enter</strong> ‚Üí Vuelve aqu√≠',
        pular: 'Saltar',
        enviarWhatsApp: 'Enviar en WhatsApp',
        enviadoProximo: '¬°Enviado! Siguiente',
        fechar: 'Cerrar',
        nomeCompleto: 'Nombre Completo',
        nomeSobrenome: 'Nombre y apellido',
        telefoneWhatsApp: 'Tel√©fono (WhatsApp)',
        mensagemPromocao: 'Mensaje de Promoci√≥n',
        digiteMensagemPromocao: 'Escribe el mensaje de promoci√≥n...',
        variavelDisponivel: 'Variable disponible:',
        selecionarTodos: 'Seleccionar todos',
        enviarSelecionados: 'Enviar a Seleccionados',
        enviandoPromocao: 'Enviando Promoci√≥n',
        hoje: 'Hoy',
        atrasado: 'Atrasado',
        futuro: 'Futuro',
        editar: 'Editar',
        excluir: 'Eliminar',
        restaurar: 'Restaurar',
        cobrar: 'Cobrar',
        reenviar: 'Reenviar',
        notinhaSalva: '¬°Nota guardada con √©xito!',
        notinhaAtualizada: '¬°Nota actualizada!',
        notinhaExcluida: '¬°Nota movida a la papelera!',
        clienteSalvo: '¬°Cliente guardado con √©xito!',
        clienteExcluido: '¬°Cliente eliminado!',
        configSalvas: '¬°Configuraci√≥n guardada!',
        erroSalvar: 'Error al guardar',
        diasRestantesBadge: 'd√≠as',
        clienteJaExiste: '¬°Ya existe un cliente con este tel√©fono!',
        de: 'de',
        nenhumaNotinha: 'Ninguna nota encontrada',
        nenhumCliente: 'Ning√∫n cliente registrado',
        nenhumInadimplente: 'Ning√∫n moroso',
        nenhumExcluido: 'Ning√∫n elemento eliminado',
        enviado: 'Enviado',
        agendado: 'Programado'
    }
};

let idiomaAtual = localStorage.getItem('idioma') || 'pt';

function t(chave) {
    return traducoes[idiomaAtual][chave] || traducoes['pt'][chave] || chave;
}

function aplicarTraducoes() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const chave = el.getAttribute('data-i18n');
        const traducao = t(chave);
        if (traducao) {
            if (el.innerHTML.includes('<strong>') || el.innerHTML.includes('<code>')) {
                el.innerHTML = traducao;
            } else {
                el.textContent = traducao;
            }
        }
    });

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const chave = el.getAttribute('data-i18n-placeholder');
        const traducao = t(chave);
        if (traducao) el.placeholder = traducao;
    });

    document.querySelectorAll('[data-i18n-title]').forEach(el => {
        const chave = el.getAttribute('data-i18n-title');
        const traducao = t(chave);
        if (traducao) el.title = traducao;
    });

    if (idiomaAtual === 'en') {
        window.formatarDataLocale = 'en-US';
    } else if (idiomaAtual === 'es') {
        window.formatarDataLocale = 'es-ES';
    } else {
        window.formatarDataLocale = 'pt-BR';
    }
}

function mudarIdioma(novoIdioma) {
    idiomaAtual = novoIdioma;
    localStorage.setItem('idioma', novoIdioma);
    
    document.getElementById('idioma-atual').textContent = novoIdioma.toUpperCase();
    
    document.querySelectorAll('.idioma-opcao').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === novoIdioma);
    });
    
    document.getElementById('idioma-dropdown').classList.remove('show');
    
    aplicarTraducoes();
    
    renderizarNotinhas(todasNotinhas);
    renderizarExcluidos();
    renderizarInadimplentes(notinhasInadimplentes);
}

function toggleIdiomaDropdown() {
    const dropdown = document.getElementById('idioma-dropdown');
    dropdown.classList.toggle('show');
}

function inicializarIdioma() {
    const idiomaGuardado = localStorage.getItem('idioma') || 'pt';
    idiomaAtual = idiomaGuardado;
    document.getElementById('idioma-atual').textContent = idiomaAtual.toUpperCase();
    document.querySelectorAll('.idioma-opcao').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === idiomaAtual);
    });
    aplicarTraducoes();
}

